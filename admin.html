<!-- admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin | Sejal Memsab</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      background-color: #f6ece6;
      font-family: 'Playfair Display', serif;
      color: #8a2154;
      text-align: center;
      padding: 60px 20px;
    }
    .admin-container {
      max-width: 600px;
      margin: 0 auto;
      background: #F3E5E2;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 2px solid #E0B9C0;
    }
    h1 {
      color: #8a2154;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }
    p {
      color: #5c4033;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }
    /* Custom File Input Styling */
    .file-input-container {
      margin: 30px 0;
      position: relative;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
      max-width: 400px;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
      z-index: 2;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 20px 25px;
      background: linear-gradient(135deg, #F8F0ED 0%, #F3E5E2 100%);
      border: 3px dashed #E0B9C0;
      border-radius: 20px;
      color: #8a2154;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.4s ease;
      min-height: 80px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(138, 33, 84, 0.1);
      position: relative;
      overflow: hidden;
    }

    .file-input-label::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .file-input-label:hover::before {
      opacity: 1;
    }

    .file-input-label:hover {
      border-color: #d74971;
      background: linear-gradient(135deg, #F3E5E2 0%, #F8F0ED 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(138, 33, 84, 0.2);
    }

    .file-input-label.drag-over {
      border-color: #8a2154;
      background: linear-gradient(135deg, #E8D8E0 0%, #F0E0E8 100%);
      transform: scale(1.02);
      box-shadow: 0 10px 30px rgba(138, 33, 84, 0.3);
    }

    .file-input-icon {
      font-size: 1.8em;
      color: #d74971;
      transition: transform 0.3s ease;
    }

    .file-input-label:hover .file-input-icon {
      transform: scale(1.2) rotate(10deg);
    }

    .file-input-text {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .file-input-primary-text {
      color: #8a2154;
      font-weight: 600;
    }

    .file-input-secondary-text {
      color: #b56585;
      font-size: 0.9rem;
      font-style: italic;
    }

    .file-input-wrapper:focus-within .file-input-label {
      border-color: #8a2154;
      box-shadow: 0 0 0 3px rgba(138, 33, 84, 0.2);
    }
    .upload-btn {
      background: linear-gradient(135deg, #8a2154 0%, #d74971 100%);
      color: white;
      border: none;
      padding: 15px 35px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(138, 33, 84, 0.3);
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
    }

    .upload-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s ease;
    }

    .upload-btn:hover::before {
      left: 100%;
    }

    .upload-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(138, 33, 84, 0.5);
      background: linear-gradient(135deg, #d74971 0%, #8a2154 100%);
    }

    .upload-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 2px 10px rgba(138, 33, 84, 0.4);
    }

    .upload-btn .btn-icon {
      margin-right: 8px;
      font-size: 1.2em;
    }

    .upload-btn .btn-text {
      position: relative;
      z-index: 1;
    }

    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1) rotate(180deg); }
    }

    .upload-btn:hover .btn-icon {
      animation: sparkle 1.5s ease-in-out infinite;
    }

    .upload-btn::after {
      content: '💫';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 1.5em;
      opacity: 0;
      transition: all 0.4s ease;
      pointer-events: none;
    }

    .upload-btn:hover::after {
      opacity: 1;
      transform: rotate(15deg) scale(1.2);
      animation: twinkle 2s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.7; transform: rotate(15deg) scale(1.2); }
      50% { opacity: 1; transform: rotate(-15deg) scale(1.4); }
    }
    .status {
      margin-top: 20px;
      font-size: 1rem;
      color: #d74971;
    }
    .decoration-image {
      position: absolute;
      width: 10%;
      opacity: 0.6;
      z-index: -1;
    }
    .bottom-left { bottom: 10%; left: 5%; }
    .top-right { top: 10%; right: 5%; }
  </style>
</head>
<body>

  <!-- Decorative Images -->
  <img src="https://static.vecteezy.com/system/resources/previews/024/257/070/original/pink-heart-washi-tape-png.png" alt="" class="decoration-image bottom-left">
  <img src="https://i.pinimg.com/1200x/7e/f7/bd/7ef7bd8aaf022215829f8a9ccc2f22da.jpg" alt="" class="decoration-image top-right">

  <div class="admin-container">
    <h1>Upload New Image</h1>
    <p>Choose a photo to add to the gallery. It will appear instantly!</p>

    <div class="file-input-container">
      <div class="file-input-wrapper">
        <input type="file" id="imageUpload" accept="image/*" multiple />
        <div class="file-input-label">
          <span class="file-input-icon">📸</span>
          <div class="file-input-text">
            <span class="file-input-primary-text">Choose Images</span>
            <span class="file-input-secondary-text">or drag & drop here</span>
          </div>
        </div>
      </div>
    </div>
    <button class="upload-btn" onclick="uploadImages()">
      <span class="btn-icon">✨</span>
      <span class="btn-text">Upload Images</span>
    </button>
    <div class="status" id="status"></div>

    <!-- Image Preview Area -->
    <div id="previewContainer" style="display: none; margin: 20px 0;">
      <h3 style="color: #8a2154; margin-bottom: 15px;">Selected Images:</h3>
      <div id="imagePreviews" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;"></div>
      <button onclick="clearSelection()" style="background: #d74971; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer;">Clear All</button>
    </div>
  </div>

 <script type="module">
  // Import Supabase Client
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

  const supabaseUrl = "https://zyccqzskdnxbdujqrwfx.supabase.co";  // ← Replace with your Project URL
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5Y2NxenNrZG54YmR1anFyd2Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NTkzMDUsImV4cCI6MjA3NDEzNTMwNX0.EOcASUc2J_zUdvfzQNYuvtXFCREBliKDA6HxmKquPTk";      // ← Replace with your anon key
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Handle file selection and show previews
  function handleFileSelection() {
    const fileInput = document.getElementById('imageUpload');
    const previewContainer = document.getElementById('previewContainer');
    const imagePreviews = document.getElementById('imagePreviews');
    const status = document.getElementById('status');

    if (fileInput.files.length > 0) {
      previewContainer.style.display = 'block';
      imagePreviews.innerHTML = '';

      Array.from(fileInput.files).forEach((file, index) => {
        const previewDiv = document.createElement('div');
        previewDiv.style.cssText = `
          position: relative;
          width: 80px;
          height: 80px;
          border-radius: 8px;
          overflow: hidden;
          border: 2px solid #E0B9C0;
        `;

        const img = document.createElement('img');
        img.style.cssText = 'width: 100%; height: 100%; object-fit: cover;';
        img.src = URL.createObjectURL(file);

        const removeBtn = document.createElement('button');
        removeBtn.innerHTML = '×';
        removeBtn.style.cssText = `
          position: absolute;
          top: -5px;
          right: -5px;
          background: #d74971;
          color: white;
          border: none;
          border-radius: 50%;
          width: 20px;
          height: 20px;
          font-size: 12px;
          cursor: pointer;
          display: none;
        `;

        previewDiv.addEventListener('mouseenter', () => removeBtn.style.display = 'block');
        previewDiv.addEventListener('mouseleave', () => removeBtn.style.display = 'none');

        removeBtn.addEventListener('click', () => {
          // Remove file from input
          const dt = new DataTransfer();
          Array.from(fileInput.files).forEach((f, i) => {
            if (i !== index) dt.items.add(f);
          });
          fileInput.files = dt.files;

          // Update previews
          handleFileSelection();
        });

        previewDiv.appendChild(img);
        previewDiv.appendChild(removeBtn);
        imagePreviews.appendChild(previewDiv);
      });

      status.textContent = `${fileInput.files.length} image(s) selected`;
    } else {
      previewContainer.style.display = 'none';
      status.textContent = '';
    }
  }

  // Clear all selected files
  function clearSelection() {
    const fileInput = document.getElementById('imageUpload');
    const previewContainer = document.getElementById('previewContainer');
    const status = document.getElementById('status');

    fileInput.value = '';
    previewContainer.style.display = 'none';
    status.textContent = '';
  }

  // Upload multiple images
  async function uploadImages() {
    const fileInput = document.getElementById('imageUpload');
    const status = document.getElementById('status');
    const files = fileInput.files;

    if (files.length === 0) {
      status.innerHTML = '<span style="color: #d74971;">Please select images to upload</span>';
      return;
    }

    status.innerHTML = `
      <div id="uploadProgress">
        <p>Uploading ${files.length} image(s)...</p>
        <div id="progressContainer" style="margin: 10px 0;"></div>
      </div>
    `;

    const progressContainer = document.getElementById('progressContainer');
    const uploadPromises = [];

    // Create progress items for each file
    Array.from(files).forEach((file, index) => {
      const progressItem = document.createElement('div');
      progressItem.style.cssText = `
        margin: 5px 0;
        padding: 8px;
        background: #F3E5E2;
        border-radius: 5px;
        border: 1px solid #E0B9C0;
      `;
      progressItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span style="font-size: 12px; color: #8a2154;">${file.name}</span>
          <span id="progress-${index}" style="font-size: 12px; color: #5c4033;">0%</span>
        </div>
        <div style="width: 100%; height: 4px; background: #E0B9C0; border-radius: 2px;">
          <div id="bar-${index}" style="height: 100%; width: 0%; background: #8a2154; border-radius: 2px; transition: width 0.3s;"></div>
        </div>
      `;
      progressContainer.appendChild(progressItem);

      // Upload each file
      const uploadPromise = (async () => {
        try {
          const fileName = `${Date.now()}-${index}-${file.name}`;

          const { data, error } = await supabase.storage
            .from('gallery-images')
            .upload(fileName, file);

          if (error) throw error;

          // Simulate progress updates
          const progressBar = document.getElementById(`bar-${index}`);
          const progressText = document.getElementById(`progress-${index}`);

          const progressInterval = setInterval(() => {
            const currentWidth = parseInt(progressBar.style.width) || 0;
            if (currentWidth < 90) {
              const newWidth = currentWidth + 10;
              progressBar.style.width = `${newWidth}%`;
              progressText.textContent = `${newWidth}%`;
            }
          }, 100);

          // Complete progress
          setTimeout(() => {
            clearInterval(progressInterval);
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
            progressItem.style.background = '#E8F5E8';
            progressItem.style.borderColor = '#4CAF50';
          }, 1000);

          return { success: true, fileName, url: null };
        } catch (error) {
          console.error(`Upload failed for ${file.name}:`, error);
          const progressItem = document.querySelector(`#progress-${index}`).parentElement.parentElement;
          progressItem.style.background = '#FFE8E8';
          progressItem.style.borderColor = '#f44336';
          progressItem.innerHTML += `<div style="color: #f44336; font-size: 11px; margin-top: 5px;">Failed: ${error.message}</div>`;
          return { success: false, fileName: file.name, error: error.message };
        }
      })();

      uploadPromises.push(uploadPromise);
    });

    // Wait for all uploads to complete
    const results = await Promise.allSettled(uploadPromises);

    // Show final status
    const successful = results.filter(r => r.status === 'fulfilled' && r.value.success).length;
    const failed = results.length - successful;

    setTimeout(() => {
      if (failed === 0) {
        status.innerHTML = `
          <div style="color: #4CAF50; font-weight: bold;">
            ✅ All ${successful} image(s) uploaded successfully!<br>
            <small style="color: #5c4033;">They will appear in the gallery shortly.</small>
          </div>
        `;
      } else {
        status.innerHTML = `
          <div style="color: #ff9800;">
            ⚠️ ${successful} uploaded, ${failed} failed<br>
            <small style="color: #5c4033;">Check console for details.</small>
          </div>
        `;
      }

      // Clear file input and previews after 5 seconds
      setTimeout(() => {
        clearSelection();
      }, 5000);
    }, 1500);
  }

  // Drag and drop functionality
  function setupDragAndDrop() {
    const fileInputWrapper = document.querySelector('.file-input-wrapper');
    const fileInputLabel = document.querySelector('.file-input-label');
    const fileInput = document.getElementById('imageUpload');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileInputWrapper.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
      fileInputWrapper.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      fileInputWrapper.addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    fileInputWrapper.addEventListener('drop', handleDrop, false);

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    function highlight() {
      fileInputLabel.classList.add('drag-over');
    }

    function unhighlight() {
      fileInputLabel.classList.remove('drag-over');
    }

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;

      // Add dropped files to the input
      if (files.length > 0) {
        fileInput.files = files;
        handleFileSelection();
      }
    }
  }

  // Event listeners
  document.getElementById('imageUpload').addEventListener('change', handleFileSelection);

  // Initialize drag and drop
  setupDragAndDrop();

  // Make functions global
  window.uploadImages = uploadImages;
  window.clearSelection = clearSelection;
</script>

</body>
</html>
